
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>the fancy part of the web</title>
  <meta name="author" content="Tolleiv Nietsch">

  
  <meta name="description" content="I use firebug for a while and I love it especially for CSS and JS debugging. Today I stumbled over Yslow and did some tests with it one some of my &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://tolleiv.github.io/blog/page/9">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="the fancy part of the web" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>


  

</head>

<body   >
  <header role="banner"><hgroup>
</hgroup>

</header>
  <!-- <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:tolleiv.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav> -->
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/06/yslow-powerful-ff-extension/">YSlow - Powerful FF Extension</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-06-30T19:30:00+02:00" pubdate data-updated="true">Jun 30<span>th</span>, 2008</time>
        
         | <a href="/2008/06/yslow-powerful-ff-extension/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I use <a href="http://www.getfirebug.com/">firebug</a> for a while and I love it especially for CSS and JS debugging. Today I stumbled over <a href="http://developer.yahoo.com/yslow/">Yslow</a> and did some tests with it one some of my clients pages and I love the results.<br/>
YSlow can help you to analyze all the referenced elements on a webpage. It shows their sizes, how they behave when a page is taken from the browser-cache, shows optimization hints and enables a easy way to optimize the output of your dynamically created webpage :) &hellip; you&rsquo;ll love it.<br/>
<a href="http://developer.yahoo.com/yslow/">Get YSlow here :)</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/06/musique/">Musique</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-06-29T21:36:00+02:00" pubdate data-updated="true">Jun 29<span>th</span>, 2008</time>
        
         | <a href="/2008/06/musique/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>sooo nice :P</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/06/factory-gof/">Factory [GoF]</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-06-23T20:20:00+02:00" pubdate data-updated="true">Jun 23<span>rd</span>, 2008</time>
        
         | <a href="/2008/06/factory-gof/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Do you remember the <a href="http://www.cookiepattern.com/2008/06/faade-gof.html">Fa</a><a href="http://www.cookiepattern.com/2008/06/faade-gof.html">รง</a><a href="http://www.cookiepattern.com/2008/06/faade-gof.html">ade pattern</a> post? Sure you do :) &ndash; I described a child which asked his granny whether she could bake some cookies. So how this happens in a formal way was describe within the<a href="http://www.cookiepattern.com/2008/06/faade-gof.html"> Fa</a><a href="http://www.cookiepattern.com/2008/06/faade-gof.html">รง</a><a href="http://www.cookiepattern.com/2008/06/faade-gof.html">ade pattern</a> post ;) but the basic action &ldquo;to ask for sth.&rdquo; is described here&hellip;</p>

<p>As you might remember we had a child, probably a lazy one, which was in the mood to eat some cookies but since the cookie tin was empty it asked his granny to bake some new. In OOP thats nearly the same &ndash; when you&rsquo;d to have a (complex) object and if you don&rsquo;t already have one you need someone who creates it or you do it yourself but since you need remember all the steps to create it, that&rsquo;s something for programmers who likes to type :P</p>

<p>So normally you create a method which wraps up all the code to create the complex object. Or maybe you have  a Aggregate and you don&rsquo;t want that everyone needs to know how it is build up then this method should be the only way to access the Aggregate.</p>

<p>You see now how you can benefit when you have a Factory available &ndash; but there are also some drawbacks. Factories tend to be hard to extend &ndash; this happens because the factory has a very deep (mostly hard-coded) knowledge of the objects it creates and normally all the wiring happens statically. If you&rsquo;re looking for a dynamic way to wire up your objects you might end making heavy use of reflection. In normal projects this might be a bit too much ;)</p>

<p>A normal factory method, for a cookie which requires to have 3 flavors, a predefined size and that it&rsquo;s baked before anyone consumes it, could look like this:</p>

<p>class Cookie {</p>

<p> // &hellip;</p>

<p> /<em><br/>
  * Create a Cookie object which consists<br/>
  * of 3 flavors and has a defined size.<br/>
  </em>/ <br/>
 public function getInstance() {</p>

<pre><code> $c = new Cookie();  
 $c-&gt;setFlavor(Cookie::randomFlavor());  
 $c-&gt;setFlavor(Cookie::randomFlavor());  
 $c-&gt;setFlavor(Cookie::randomFlavor());  
 $c-&gt;setSize(Cookie::randomSize());  
 $c-&gt;bakeIt();  
 return $c;       
</code></pre>

<p> }</p>

<p>}</p>

<p>If your software contains some complexity where you want to switch the used objects (created by a factory) without modifying the clients, which make use of the factory, you&rsquo;ll end up with the so called Abtract factory.</p>

<p>Let&rsquo;s say you have two types of Cookies &ndash; the first one is a high-quality cookie with a bunch of different flavors and the second one is a normal chocolate-cookie. The high-quality cookie is created by your granny (slow but mind-blowing taste), the cookies with the lower quality are the result of mass-production. Your &ldquo;client&rdquo; is a wrapping machine which does everything to deliver the cookies to some customers.<br/>
So the wrapping machine won&rsquo;t care what kind of cookies are prepared for delivering and so it doesn&rsquo;t matter who the creator is &ndash; the only thing it has to know is how it can access the cookies&hellip; some kind of interface.<br/>
So the entire szenario could look like this:</p>

<p>class Cookie {</p>

<p>}</p>

<p>interface CookieFactory {<br/>
 abstract function createCookie();<br/>
}</p>

<p>class Granny implements CookieFactory {<br/>
 public function createCookie() {</p>

<pre><code> $cookie = new Cookie();  
 // do some wierd cookie-creation stuff //  
 return $cookie;  
</code></pre>

<p> }<br/>
}</p>

<p>class MassProduction implements CookieFactory {<br/>
 public function createCookie() {</p>

<pre><code> return new Cookie();  
</code></pre>

<p> }<br/>
}</p>

<p>class wrappingMachine {<br/>
 public function run(CookieFactory $factory) {</p>

<pre><code> $i = 6;  
 $package=array();  
 while($i--) {  
     $package[] = $factory-&gt;createCookie();           
 }  
 return $package;  
</code></pre>

<p> }<br/>
}</p>

<p>Client-code could look like this;</p>

<p>$wrapper = new wrappingMachine();<br/>
$highQualityCookiePackage = $wrapper->run(new Granny());<br/>
$lowQualityCookiePackage = $wrapper->run(new MassProduction());</p>

<p>Thats mostly what you can achieve with some normal Factories in the GoF-meaning. Some other interesting ways of object creation are the <a href="http://www.cookiepattern.com/2008/06/plugin-poeaa.html">Plugin pattern</a> and the  <a href="http://www.cookiepattern.com/2008/05/prototype-gof.html">Prototype pattern</a>. :)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/06/query-object-poeea/">Query Object [PoEEA]</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-06-20T19:29:00+02:00" pubdate data-updated="true">Jun 20<span>th</span>, 2008</time>
        
         | <a href="/2008/06/query-object-poeea/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Maybe you remember the <a href="http://www.cookiepattern.com/2008/05/specification-ddd.html">Specification Pattern</a> I explained some weeks ago. It enabled a easy and intuitive  searching within large object-collections. A drawback of my example was that I stored the objects in the memory. This can be really ineffective if you want a single object out of hundreds, because you have to create all of them to see which one fits the specification.
Normally you want to limit the number of objects and you also don&rsquo;t store large datasets in memory. The idea of the Query Object pattern is that it enables a usage, comparable to the specification pattern, for objects which are persisted in a database. The benefit is that it creates a query to exclude objects which won&rsquo;t satisfy your needs and therefore you wont mess up the memory anymore.
Once you have a query-object in place you should not get in touch with SQL anymore because it can encapsulate SQL completely, at least if you also have some kind of data mapping (coming soon), which is a great benefit for everyone who is not so familiar with SQL. (But don&rsquo;t forget, regarding performance, SQL-optimization is a very important thing).</p>

<p>So what we need for the Query Object in first place is a object, I&rsquo;ll use the Cookie out of the <a href="http://www.cookiepattern.com/2008/05/specification-ddd.html">specification pattern post</a> again. Then we need criteria-objects which hold the information for a single criteria, (determined by &ldquo;database-field&rdquo;, &ldquo;operator&rdquo; and &ldquo;value&rdquo;) and we also need the Query Objects itself to wrap up the SQL-querying and the object creation somehow.</p>

<p>A very simple example could look like this:</p>

<p>interface Critera {
public function getWhereClause();
}</p>

<p>class CookieCriteria implements Critera {</p>

<p>private $operator,$field,$value;</p>

<p>protected function __construct($operator,$field,$value) {
$this->operator=$operator;
$this->field=$field;
$this->value=$value;
}</p>

<p>public function getWhereClause() {
return implode(&ldquo; &rdquo;,array($this->field,$this->operator,$this->value));
}</p>

<p>public static function matches($field,$value) {
return new CookieCriteria(&ldquo;LIKE&rdquo;,$field,&lsquo;&ldquo;&rsquo;.$value.&lsquo;&rdquo;&rsquo;);
}</p>

<p>public static function greaterThan($field,$value) {
return new CookieCriteria(&ldquo;>&rdquo;,$field,$value);
}
}</p>

<p>class CookieFinder {
protected $criterias;</p>

<p>public function addCriteria(Critera $criteria) {
$this->criterias[] = $criteria;
}</p>

<p>public function generateSQL() {
$sql = &ldquo;SELECT * FROM cookies&rdquo;;</p>

<p>if(sizeof($this->criterias)) {
$where=array();
reset($this->criterias);
while(list(,$criteria)=each($this->criterias)) {
$where[] = $criteria->getWhereClause();
}
$sql.= sizeof($where)?&ldquo; WHERE &rdquo;.implode(&ldquo; AND &rdquo;,$where):&ldquo;&rdquo;;
}
return $sql;
}</p>

<p>public function find() {
$collection = array();
if(!$result = mysql_query($this->generateSQL())) {
throw new Exception(mysql_errno());
}
while($row = mysql_fetch_assoc($result)) {
$collection[] = new Cookie($row[&lsquo;name&rsquo;],$row[&lsquo;flavor&rsquo;],$name[&lsquo;size&rsquo;]);
}
return $collection;
}
}</p>

<p>Possible client code could look like this:
$finder = new CookieFinder();
$finder->addCriteria(CookieCriteria::matches(&ldquo;name&rdquo;,&ldquo;Granny%&rdquo;));
$finder->addCriteria(CookieCriteria::greaterThan(&ldquo;size&rdquo;,100));
$cookies = $finder->find();</p>

<p>We just pick up the Query Object, add one or more criteria and ask it to create the objects which fit them.</p>

<p>So this example is not as powerful as the one I used for the <a href="http://www.cookiepattern.com/2008/05/specification-ddd.html">Specification pattern</a>, but it should be a easy task to create some kind of &ldquo;nested criteria objects&rdquo;.
Query objects normally make use of data-mapping so that you can handle various classes, stored in different tables/databases, with a single and generic Query Object. This also enables to avoid SQL-Injection, since you&rsquo;re able to validate the fields and values before you sent them to your database, also some kind of database abstraction would be possible.
With the &ldquo;Query Object by example&rdquo;, which requires to build up a single object which is used as blueprint for the required objects, exists another flavor of this pattern which is very handy to use and more descriptive.
But no matter which flavor you prefer, Query Objects bring some real benefits when you&rsquo;ve to handle complex datasets &ndash; for smaller projects the effort might be to much so be careful where you use it.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/06/i-laughed/">&#8230; I Laughed</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-06-19T17:40:00+02:00" pubdate data-updated="true">Jun 19<span>th</span>, 2008</time>
        
         | <a href="/2008/06/i-laughed/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>A friend of mine just posted that to the IM:<br/>
&ldquo;Hey they finally found water on the mars&hellip; this pic proves it: <a href="http://apod.nasa.gov/apod/image/0504/WaterOnMars2_gcc.jpg">http://apod.nasa.gov/apod/image/0504/WaterOnMars2_gcc.jpg</a>&rdquo; &hellip;. kkthxbye</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/06/facade-gof/">Faรงade [GoF]</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-06-17T01:33:00+02:00" pubdate data-updated="true">Jun 17<span>th</span>, 2008</time>
        
         | <a href="/2008/06/facade-gof/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>If a child is in the mood to eat a fresh cookie it normally asks his granny for one. Like this:</p>

<p>Child: Grannyyyyy?<br/>
Granny: Yes my dear?<br/>
Child: Could you mix about 2 cups of sugar, &frac12; cup of butter and &frac12; cup of milk in a saucepan and boil it for a minute. And could you, after you removed the saucepan from the heat, mix in some cocoa powder and 3 cups quick cooking oats and form some cookies? Pleeease?</p>

<p>Hm you&rsquo;re right that&rsquo;s not very realistic &ndash; it&rsquo;s more like: &ldquo;Grannyyyy? Could I have a cooookieee pleeeease?&rdquo; &hellip;.the granny knows what to do and the child will get it&rsquo;s cookie</p>

<p>So what happens if you have a pice of software which provides <strike>cookies</strike> some services for other parts of your software? The most people (especially programmers) are lazy and they won&rsquo;t remember all the details of a complex structure. They remember the place or object which can run a certain task but there&rsquo;s no need to know the deeper structure of that object &ndash; the only thing which is important if your using a service of an object is that it doesn&rsquo;t fail.<br/>
So the Faรงade pattern is a structural pattern which more or less describes that you create a object with an simplified interface, so that you can hide complex structures. You can also use a Faรงade to wrap up some poorly designed APIs into a single well designed API. And the larges benefit of a Faรงade object is that it makes APIs more readable and therefore enables flexible and easy development.</p>

<p>So maybe you&rsquo;re missing the example-code for this pattern, but since it&rsquo;s not that concrete as others, I&rsquo;ve not implemented a  special example for it. But I already used a Facade in some way, if you look at the <a href="http://www.cookiepattern.com/2008/05/specification-ddd.html">Specification pattern</a>, you&rsquo;ll find the functions getSmallChocolateCookies() and getLargeCookies(). Both show in a tasty way what I described  here :)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/06/todays-rofl-2/">Today&#8217;s Rofl</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-06-16T00:28:00+02:00" pubdate data-updated="true">Jun 16<span>th</span>, 2008</time>
        
         | <a href="/2008/06/todays-rofl-2/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I just found this with the  Stumble-Button: <a href="http://www.lessaid.net/fun/apt-get-wife.png">http://www.lessaid.net/fun/apt-get-wife.png</a> &ndash; so true :)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/06/inherit-abstract-functions/">Inherit Abstract Functions&#8230;.</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-06-11T22:28:00+02:00" pubdate data-updated="true">Jun 11<span>th</span>, 2008</time>
        
         | <a href="/2008/06/inherit-abstract-functions/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>A error I find from time to time when I work with inheritance is this one:</p>

<p>Fatal error: Can&rsquo;t inherit abstract function Cookie::setFlavor() (previously declared abstract in ChocolateCookie) in &hellip;</p>

<p>This happens when you try to define multiple abstract classes or interfaces with the same abstract functions &ndash; it&rsquo;s right that this errors shows up, but today I stuck on this error for a while because I did not see the reason for that &ndash; so that&rsquo;s a reminder for me ;)</p>

<p>And the tasty example to reproduce this error:</p>

<p>abstract class Cookie {<br/>
abstract public function setFlavor($flavor);<br/>
}</p>

<p>abstract class ChocolateCookie extends Cookie {<br/>
abstract public function setFlavor($flavor);<br/>
}</p>

<p>There are also some rejected bugreports about that :P <a href="http://bugs.php.net/bug.php?id=35057">#35057</a> <a href="http://bugs.php.net/bug.php?id=35832">#35832</a> <a href="http://bugs.php.net/bug.php?id=41145">#41145</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/06/new-typo-releases/">New TYPO Releases</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-06-11T16:18:00+02:00" pubdate data-updated="true">Jun 11<span>th</span>, 2008</time>
        
         | <a href="/2008/06/new-typo-releases/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I just saw that the TYPO3 guys released a new version of the popular Enterprise CMS (<a href="http://www.typo3.org">www.typo3.org</a>). The changelog shows that they mainly changed some security issues and that a lot of  smaller changes in the backend happend &ndash; one change relates to the problems in the new Firefox 3 where all the frames in the backend are mixed up for some compatibility reason&hellip; this was also the reason why the also updates the 4.0.x branch and the 4.1.x branch &hellip;</p>

<p><a href="http://typo3.org/download/packages/">TYPO3 source package downloads</a> / <a href="http://wiki.typo3.org/index.php/Upgrade">TYPO3 upgrading guide</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/06/self-extracting-php-archive/">Self-extracting PHP Archive</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-06-07T23:30:00+02:00" pubdate data-updated="true">Jun 7<span>th</span>, 2008</time>
        
         | <a href="/2008/06/self-extracting-php-archive/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The __halt_compiler(); function in php enables to store some additional data in a php-file without blowing up the memory. A very nice possibility is to use this for a self-extracting php file as installation-packages of your php application.
A wile ago I created a script which automatically creates such a archive and I think you might like it&hellip;.for the impatient ones: <a href="http://588299e40f6cb98516d7458.googlepages.com/createziparchive-0.5.1.php">Download</a> / <a href="http://588299e40f6cb98516d7458.googlepages.com/createziparchive-0.5.1.zip">Download as Zip</a>.</p>

<p>Before I start to show how the entire script works I&rsquo;d like to show you a small example so that you can see how the __halt_compiler(); function can be used to store some data at the end of a file:</p>

<pre><code>$fp = fopen(__FILE__, โrโ);
fseek($fp, __COMPILER_HALT_OFFSET__);
$i=0;
while($buffer = fgets($fp)) {
    echo ($i++). โ:โ. $buffer.โ&lt;br&gt;&lt;/br&gt;โ;
};
__HALT_COMPILER();Line 1
Line 2
Line 3
Last line 
</code></pre>

<p>The first thing you might mention is, that the closing &ldquo;?>&rdquo; is missing, but since the function-name is nearly self-explaining you should realize very fast what the output of the script might be ;)</p>

<p>If that&rsquo;s working the question is what&rsquo;s needed for a script which is meant to create and extract a archive? The first thing is a way to create the archive itself. I used the PHP-builtin <a href="http://de3.php.net/manual/en/ref.zip.php">ZipArchive</a> for that. The second thing is a script which is able to extract this archiv (using the method show above). That&rsquo;s handled by the following snippet:</p>

<pre><code>try {
    $zipfilename = md5(time()).โarchive.zipโ; //remove with tempname()
    $fp_tmp = fopen($zipfilename,โwโ);
    $fp_cur = fopen(__FILE__, โrโ);
    fseek($fp_cur, __COMPILER_HALT_OFFSET__);
    $i=0;
    while($buffer = fread($fp_cur,10240)) {
        fwrite($fp_tmp,$buffer);
    }
    fclose($fp_cur);
    fclose($fp_tmp);
    $zipfile = new ZipArchive();
    if($zipfile-&gt;open($zipfilename)===true) { 
        if(!$zipfile-&gt;extractTo(โ.โ)) throw new Exception(โextraction failedโฆโ);
    } else throw new Exception(โreading archive failedโ);
    $zipfile-&gt;close();
    unlink($zipfilename);
} catch (Exception $e) {
    printf(โError:&lt;br&gt;&lt;/br&gt;%s&lt;br&gt;%s&gt;โ,$e-&gt;getMessage(),$e-&gt;getTraceAsString());
};
__HALT_COMPILER();[zipdata is appended here later] 
</code></pre>

<p>As you see that&rsquo;s no rocket-science just read the data, pass it to the ZipArchive object via a temporary file and extract the archive.
If that&rsquo;s working then you need a script which brings the PHP extraction script and the zip-data together. And since we want to have a single script for the creation of our self extracting php archive, it would be very odd if we&rsquo;d place the &ldquo;template&rdquo; for the extraction in a separate file. That&rsquo;s the reason why I just use the same method as above for this script and this time the data is php code instead of zip-data:</p>

<pre><code>try {
    $sourcefolder = โcompressthis/โ;                 // maybe you want to get this via CLI argument โฆ
    $targetname = โphparchive.phpโ;                    
    $zipfilename = md5(time()).โarchive.zipโ;         // replace with tempname()

    // create a archive from the submitted folder
    $zipfile = new ZipArchive();
    $zipfile-&gt;open($zipfilename,ZipArchive::CREATE);
    addFiles2Zip($zipfile,$sourcefolder,true);
    $zipfile-&gt;close();

    // compile the selfextracting php-archive
    $fp_dest =fopen($targetname,โwโ);    
    $fp_cur = fopen(__FILE__, โrโ);
    fseek($fp_cur, __COMPILER_HALT_OFFSET__);
    $i=0;
    while($buffer = fgets($fp_cur)) {
        fwrite($fp_dest,$buffer);
    }
    fclose($fp_cur);
    $fp_zip = fopen($zipfilename,โrโ);
    while($buffer = fread($fp_zip,10240)) {
        fwrite($fp_dest,$buffer);
    }
    fclose($fp_zip);
    fclose($fp_dest);
    unlink($zipfilename);

} catch (Exception $e) {
 echo $e-&gt;getTraceAsString();
}

function 
addFiles2Zip(ZipArchive $zip,$path,$removeFirstFolder=false) {
    $d = opendir($path);
    while($file = readdir($d)) {
        if ($file == โ.โ || $file == โ..โ) continue;
        $curfile=($removeFirstFolder)?substr($path.$file,strpos($path,โ/โ)+1):$path.$file;
        if(is_dir($path.$file)) {
            $zip-&gt;addEmptyDir($curfile);
            addFiles2Zip($zip,$path.$file.โ/โ,$removeFirstFolder);    
        } else {
            $zip-&gt;addFile($path.$file,$curfile);
        }    
    }
    closedir($d);
}


__HALT_COMPILER();[the script shown above]
</code></pre>

<p>If you all wrap up into a single script the you&rsquo;ll have something like the <a href="http://588299e40f6cb98516d7458.googlepages.com/createziparchive-0.5.1.php">script I already mentioned.</a>
I think that it could be useful to have a version with a better error-handling and maybe also some CLI functions so that there&rsquo;s no need to edit the script itself everytime&hellip; I&rsquo;ll keep you updated as soon as I have something like that :)</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/10/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/8/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <ul id="recent_posts">
      <li class="post">
      <a href="http://tolleiv.github.io" alt="Home"><img src="/images/Home.png"></a>
      <a href="http://tolleiv.github.io/archives/" alt="Archives"><img src="/images/Calendar.png"></a>
      <a href="mailto:" alt="E-Mail"><img src="/images/Envelope.png"></a>
      <a href="http://tolleiv.github.io/atom.xml" alt="subscribe feed"><img src="/images/rss_big.png"></a>
      </li>
  </ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2013/06/templavoila-followup/">TemplaVoila - Followup</a>
      </li>
    
      <li class="post">
        <a href="/2013/06/templavoila-future/">TemplaVoila Future</a>
      </li>
    
      <li class="post">
        <a href="/2013/06/genetic-algorithms-boosting-solr/">Using Genetic Algorithms to Optimize Apache Solr Boost Factors.</a>
      </li>
    
      <li class="post">
        <a href="/2012/12/re-how-to-move-on-typo3/">Re: How to Move on? #TYPO3</a>
      </li>
    
      <li class="post">
        <a href="/2012/12/typo3-login-state-and-varnish-cache/">TYPO3 Login State and Varnish Cache</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/tolleiv">@tolleiv</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'tolleiv',
            count: 1,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Tolleiv Nietsch -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'tolleiv';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
