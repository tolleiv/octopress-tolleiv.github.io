
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Tagging page caches - the fancy part of the web</title>
  <meta name="author" content="Tolleiv Nietsch">

  
  <meta name="description" content="In our small TYPO3 world it&rsquo;s quite common to have list and single views for extensions on specific pages. That&rsquo;s quite nice because once &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://tolleiv.github.io/blog/2011/12/22/tagging-page-caches">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="the fancy part of the web" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
  

</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner">
</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:tolleiv.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
  
    
      <h1 class="entry-title">Tagging Page Caches</h1>
    
  
    
      <p class="meta">
        








  


<time datetime="2011-12-22T18:23:16+01:00" pubdate data-updated="true">Dec 22<span>nd</span>, 2011</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>In our small TYPO3 world it&rsquo;s quite common to have list and single views for extensions on specific pages. That&rsquo;s quite nice because once a record is changed it allowes users to flush the caches for these pages automatically, using:</p>

<pre><code>TCEMAIN.clearCacheCmd=all|&lt;pid&gt;
</code></pre>

<p>But of course it isn&rsquo;t very smart to clear all caches once you have filled them up for hundred or even thousand records. To work around these limits it&rsquo;s quite handy to use an API which lives in <a href="http://git.typo3.org/TYPO3v4/Core.git?a=commit;h=03af46">TYPO3 since 2008</a>. It allows to add tags to the page cache and removes the caches by tag.</p>

<p>Adding tags to the current page can be done with this block:</p>

<pre><code>$GLOBALS['TSFE']-&gt;addCacheTags(array('tx_example_model:' . $id));
</code></pre>

<p>Removing the caches for that specific page could look like this:</p>

<pre><code>$GLOBALS['typo3CacheManager']-&gt;getCache('cache_pages')-&gt;flushByTag('tx_example_model:' . $id);
</code></pre>

<p>Correctly integrating this with your extension is quite easy. To set the tags, add the first block into your controller and make sure you provide the proper uid for the rendered domain objects. To remove the caches once a record is saved in the backend just register a t3lib_tcemain hook and flush the tagged caches.</p>

<p>Credits: <a href="http://twitter.com/fbrnc">Fabrizio Branca @fbrnc</a> &ndash; thx for pointing me to it ;)</p>

<hr />

<p>The <a href="http://blog.tolleiv.de/2010/03/handling-data-in-typo3-with-tcemain/">Tcemain-Hook</a> could be integrated with these two snippets:
<em>EXT:example/Classes/Hooks/Tcemain.php</em></p>

<pre><code>class Tx_Example_Hooks_Tcemain {
    public function processDatamap_afterDatabaseOperations($status, $table, $id, $fieldArray, &amp;$reference) {
        if ($table == 'tx_example_model') {
            $GLOBALS['typo3CacheManager']-&gt;getCache('cache_pages')-&gt;flushByTag('tx_example_model:' . $id);
        }
    }
}
</code></pre>

<p><em>EXT:example/ext_localconf.php</em></p>

<pre><code>$GLOBALS['TYPO3_CONF_VARS']['SC_OPTIONS']['t3lib/class.t3lib_tcemain.php']['processDatamapClass']['example'] = 'EXT:example/Classes/Hooks/Tcemain.php:Tx_Example_Hooks_Tcemain';
</code></pre>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">tolleiv</span></span>

      








  


<time datetime="2011-12-22T18:23:16+01:00" pubdate data-updated="true">Dec 22<span>nd</span>, 2011</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://tolleiv.github.io/blog/2011/12/22/tagging-page-caches/" data-via="" data-counturl="http://tolleiv.github.io/blog/2011/12/22/tagging-page-caches/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2011/11/30/signal-slots-in-extbase/" title="Previous Post: Signal / Slots in Extbase">&laquo; Signal / Slots in Extbase</a>
      
      
        <a class="basic-alignment right" href="/blog/2011/12/30/further-reading-2011/" title="Next Post: Further reading 2011">Further reading 2011 &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/06/14/templavoila-followup/">TemplaVoila - followup</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/08/templavoila-future/">TemplaVoila future</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/06/genetic-algorithms-boosting-solr/">Using genetic algorithms to optimize Apache Solr boost factors.</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/22/re-how-to-move-on-typo3/">Re: How to move on? #TYPO3</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/10/typo3-login-state-and-varnish-cache/">TYPO3 login state and Varnish cache</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Tolleiv Nietsch <br/>
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a>, customized with <a href="https://github.com/mjhea0/whiterspace">whiterspace</a>.</span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
